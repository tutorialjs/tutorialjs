window.opener&&window.opener!==window&&(document.body.classList.add("window-inline"),window.isInline=!0),$(document).ready(function(){function e(e,t,o){a.modal("hide"),n.modal("hide"),"timeout"===t?$.showNotification("Zeitüberschreitung der Anfrage","warn",!0):$.showNotification(o,"danger",!0)}function t(e,t){t.modal("hide"),$.showNotification(e,"success",!0)}var o=$(".modal"),a=$(".feedback-modal"),i=$(".feature-modal"),n=$(".problem-modal"),d=($(".modal-form"),function(e){return"Als "+e.find("#role").val()+"\nmöchte ich "+e.find("#desire").val()+",\num "+e.find("#benefit").val()+".\nAkzeptanzkriterien: "+e.find("#acceptance_criteria").val()}),l=function(o,a){a.preventDefault();var i=o[0].className.includes("feedback-modal")?"feedback":"problem",n="feedback"===i?"Feedback":"Problem "+o.find("#title").val(),l=d(o),c={text:l},r=o.find("#category").val(),s=o.find("#hasHappened").val(),f=o.find("#supposedToHappen").val();$.ajax({url:"/helpdesk",type:"POST",data:{email:"schul-cloud-support@hpi.de",modalEmail:o.find("#email").val(),subject:n,content:c,type:i,category:r,currentState:s,targetState:f},success:function(e){t("Feedback erfolgreich versendet!",o)},error:e}),$(".feedback-modal").find(".btn-submit").prop("disabled",!0)};$(".submit-helpdesk").on("click",function(e){e.preventDefault(),$(".feedback-modal").find(".btn-submit").prop("disabled",!1);var t=$(document).find("title").text(),o=t.slice(0,t.indexOf("- Schul-Cloud")===-1?t.length:t.indexOf("- Schul-Cloud"));populateModalForm(a,{title:"User Story eingeben",closeLabel:"Schließen",submitLabel:"Senden"}),a.find(".modal-form").on("submit",l.bind(this,a)),a.modal("show"),a.find("#title-area").html(o)}),$(".submit-problem").on("click",function(e){e.preventDefault(),$(".problem-modal").find(".btn-submit").prop("disabled",!1),populateModalForm(n,{title:"Problem melden",closeLabel:"Schließen",submitLabel:"Senden"}),n.find(".modal-form").on("submit",l.bind(this,n)),n.modal("show")}),o.find(".close, .btn-close").on("click",function(){o.modal("hide")}),$(".notification-dropdown-toggle").on("click",function(){$(this).removeClass("recent"),$(".notification-dropdown .notification-item.unread").each(function(){1!=$(this).data("read")&&(sendShownCallback({notificationId:$(this).data("notification-id")}),sendReadCallback($(this).data("notification-id")),$(this).data("read",!0))})}),$(".btn-create-qr").on("click",function(){var e=kjua({text:window.location.href,render:"canvas"}),t=$(".qr-show");t.empty(),t.append(e)}),$.ajax({url:"/help/releases",type:"GET",success:function(e){var t=getCookiesMap(document.cookie);populateModalForm(i,{title:"Neue Features sind verfügbar",closeLabel:"Schließen"}),t.releaseDate?e.createdAt>t.releaseDate&&(document.cookie="releaseDate="+e.createdAt+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/",i.modal("show")):(document.cookie="releaseDate="+e.createdAt+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/",i.modal("show"))},error:function(e){console.log(e)}})});