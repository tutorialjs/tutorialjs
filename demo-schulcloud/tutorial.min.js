"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},_createClass=(function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}})();!(function(t,e,s){var n=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}},{key:"easeOutQuad",value:function(t,e,s,n){return-s*(t/=n)*(t-2)+e}},{key:"checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"getElementBounds",value:function(t){var e=t.getBoundingClientRect();return{top:e.top,left:e.left,bottom:e.top+e.height,width:e.width,height:e.height}}}]),t})(),i=function t(e,n,i){var o=arguments.length>3&&arguments[3]!==s?arguments[3]:"auto";_classCallCheck(this,t),this.node=n,this.position=o,Object.keys(i).length||"function"==typeof i?i.once?this.callback=function(){this.run||(i.fn.call(this,e),this.run=!0)}:this.callback=(i.fn||i).bind(this,e):this.callback=function(){}},o=(function(t){function e(t,n,i){var o=arguments.length>3&&arguments[3]!==s?arguments[3]:{},r=o.title,l=r===s?"":r,a=o.callback,h=a===s?{}:a,p=o.position,c=p===s?"auto":p;_classCallCheck(this,e);var u=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,h,c));return u.type="normal",u.text=i,u.title=l,u}return _inherits(e,t),e})(i),r=(function(t){function n(t,i,o){var r=arguments.length>3&&arguments[3]!==s?arguments[3]:{},l=r.callback,a=l===s?{}:l,h=r.position,p=h===s?"auto":h;_classCallCheck(this,n);var c=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,a,p));return c.type="advanced",c.template=e.getElementById(o.substr(1)).childNodes[0].data,c}return _inherits(n,t),n})(i),l=(function(){function i(){var l=this,a=arguments.length>0&&arguments[0]!==s?arguments[0]:n.mandatory("Name"),h=arguments[1],p=h.selector,c=p===s?"tut-action":p,u=h.steps,m=u===s?[]:u,d=h.persistent,g=d!==s&&d,f=h.buttons,_=f===s?{}:f,v=h.padding,x=v===s?{}:v,y=h.debug,b=y!==s&&y,B=h.autoplay,C=B!==s&&B,k=h.scrollSpeed,E=k===s?800:k,L=h.animate,w=L===s||L,H=h.progressbar,S=H!==s&&H;if(_classCallCheck(this,i),this.elems=[],m.length>0){var T=!0,A=!1,O=s;try{for(var P,N=m[Symbol.iterator]();!(T=(P=N.next()).done);T=!0){var j=P.value,I=e.querySelector(j.highlight);if(!I)throw new Error("Selector "+j.highlight+" not found.");if(j.hasOwnProperty("action")){var F=new r(this,I,j.action.template);F.template=this._parseAdvancedStep(F),F.template.classList.add("custom-box"),this.elems.push(F)}else this.elems.push(new o(this,I,j.text,{title:j.title,callback:j.callback,position:j.position}))}}catch(t){A=!0,O=t}finally{try{!T&&N.return&&N.return()}finally{if(A)throw O}}}else{var z=Array.from(e.getElementsByClassName(c));if(!z.every((function(t){return t.getAttribute("t-step")}))||!z.every((function(t){return t.getAttribute("t-text")})))throw new Error("Not all steps or texts defined");z.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))})),this.elems=z.map((function(t){return new o(l,t,t.getAttribute("t-text"),{title:t.getAttribute("t-title"),position:t.getAttribute("t-position")})}))}if(0===this.elems.length)throw new Error("No activities point defined");this.name=a,this.buttonText={},this.options={selector:c,persistent:g,advancedStorage:n.checkStorageSupport(),scrolling:{speed:E,timer:null,position:0},padding:{top:x.top===s?12:_.close,left:x.left===s?12:_.close},buttons:{previous:_.previous===s?"Back":_.previous,next:_.next===s?"Next":_.next},animate:w,debug:b};var M=this._getCurrentPosition()||0;this.state={running:!1,completed:-1===M,animation:!1,transform:{translateY:0,translateX:0},type:this.elems[0].type,_firstStep:parseInt(this.options.persistent?M:0)},this.components={_step:parseInt(this.options.persistent?M:0),_eventHandler:{load:this.__load(),resize:this.__resize()},_elements:_extends({progressBar:!!S&&this._createProgressbar(),blur:this._createBlurElement()},this._createTutorialBox())},this.components._elements.highlightBox=this._createHighlightBox(this.components._elements.tutorialBox),Object.defineProperty(this,"step",{get:function(){return l.components._step},set:function(t){l.state.running&&(l.animating||(t<0&&l.close(),t===l.elems.length?(l.close(),l.components._step=-1):(l.elems[l.components._step].node.classList.remove("tutorial-highlight"),l.components._step=t,l.elems[t].node.classList.add("tutorial-highlight"),l._updateTutorialBox(),l._updateProgressBar(),l._moveHighlightBox()),l.options.persistent&&l._saveCurrentPosition()))}}),C&&t.addEventListener("load",this.components._eventHandler.load)}return _createClass(i,[{key:"start",value:function(){this.options.debug,this.state.running||-1===this.step||(this.elems[this.step].node.classList.add("tutorial-highlight"),e.body.appendChild(this.components._elements.blur),e.body.appendChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.appendChild(this.components._elements.progressBar),this._moveHighlightBox(),this._updateTutorialBox(),this._updateProgressBar(),this._checkAndFixHighlightboxOrientation(),this.state.running=!0,t.addEventListener("resize",this.components._eventHandler.resize))}},{key:"close",value:function(){this.state.running&&(this.state.running=!1,this.elems[this.step].node.classList.remove("tutorial-highlight"),this.components._elements.highlightBox.style.transform="",this.components._elements.highlightBox.firstChild.style.transform="",e.body.removeChild(this.components._elements.blur),e.body.removeChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.removeChild(this.components._elements.progressBar),t.removeEventListener("resize",this.components._eventHandler.resize))}},{key:"prev",value:function(){this.step--,this.options.debug}},{key:"next",value:function(){this.elems[this.step].callback(),this.step++,this.options.debug}},{key:"goToStep",value:function(t){if(this.state.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.step=t)}}},{key:"reset",value:function(){this.components._step=0,this.state._firstStep=0,this.state.transform.translateX=0,this.state.transform.translateY=0}},{key:"_parseAdvancedStep",value:function(n){var o=this,r=e.createElement("div"),l=i.actions.baseAttributes,a=i.actions.custom;r.insertAdjacentHTML("afterbegin",n.template);var h=!0,p=!1,c=s;try{for(var u,m=r.getElementsByTagName("*")[Symbol.iterator]();!(h=(u=m.next()).done);h=!0){var d=u.value,g=!0,f=!1,_=s;try{for(var v,x=Object.entries(l)[Symbol.iterator]();!(g=(v=x.next()).done);g=!0)!(function(){var t=v.value;Array.from(d.attributes).some((function(e){return e.name.includes(t[0])}))&&d.addEventListener("click",(function(){t[1].call(o)}))})()}catch(t){f=!0,_=t}finally{try{!g&&x.return&&x.return()}finally{if(f)throw _}}var y=!0,b=!1,B=s;try{for(var C,k=a[Symbol.iterator]();!(y=(C=k.next()).done);y=!0){var E=C.value,L=!0,w=!1,H=s;try{for(var S,T=Array.from(d.attributes)[Symbol.iterator]();!(L=(S=T.next()).done);L=!0)!(function(){var e=S.value;e.name.includes(E.key)&&d.addEventListener(E.event,(function(){t[e.value]()}))})()}catch(t){w=!0,H=t}finally{try{!L&&T.return&&T.return()}finally{if(w)throw H}}}}catch(t){b=!0,B=t}finally{try{!y&&k.return&&k.return()}finally{if(b)throw B}}}}catch(t){p=!0,c=t}finally{try{!h&&m.return&&m.return()}finally{if(p)throw c}}return r}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,s=e.createElement("div");return s.classList.add("tutorial-blur"),s.addEventListener("click",(function(e){t.close()})),s}},{key:"_createHighlightBox",value:function(t){var s=e.createElement("div"),n=s.cloneNode(),i=e.createElement("i");return s.classList.add("tutorial-wrapper"),n.classList.add("tutorial-background"),i.classList.add("tutorial-index"),s.addEventListener("click",(function(t){t.stopPropagation()})),s.appendChild(n),s.appendChild(i),s.appendChild(t),s}},{key:"_createTutorialBox",value:function(){var t=this,s=e.createElement("div"),n=s.cloneNode(!1),i=e.createElement("p"),o=e.createElement("p"),r=o.cloneNode(),l=s.cloneNode(!1),a=s.cloneNode(!1),h=e.createElement("a");h.href="#";var p=h.cloneNode(!1),c=h.cloneNode(!1);return s.classList.add("tutorial-box"),n.classList.add("tutorial-box-wrapper"),i.classList.add("tutorial-title"),o.classList.add("tutorial-description"),r.classList.add("tutorial-step-position"),l.classList.add("tutorial-buttons"),c.classList.add("tutorial-close"),h.textContent=this.options.buttons.previous,p.textContent=this.options.buttons.next,c.addEventListener("click",(function(e){t.close()}),!1),h.addEventListener("click",(function(e){t.prev()}),!1),p.addEventListener("click",(function(e){t.next()}),!1),Object.defineProperties(this.buttonText,{next:{get:function(){return t.options.buttons.next},set:function(e){t.options.buttons.next=e,p.textContent=e}},prev:{get:function(){return t.options.buttons.previous},set:function(e){t.options.buttons.previous=e,h.textContent=e}}}),l.appendChild(r),l.appendChild(c),l.appendChild(a),a.appendChild(h),a.appendChild(p),n.appendChild(i),n.appendChild(o),n.appendChild(l),s.appendChild(n),{tutorialBox:s,tutorialWrapper:n,tutorialTitle:i,tutorialText:o,tutorialPosition:r,tutorialButtonNext:p,tutorialButtonPrev:h}}},{key:"_createProgressbar",value:function(){var t=this,s=e.createElement("div"),n=e.createElement("ul"),i=e.createElement("div"),o=e.createElement("span");s.classList.add("progressbar-wrapper"),i.classList.add("progressbar-track");for(var r=[],l=0;l<=this.elems.length-1;l++){var a=e.createElement("li"),h=e.createElement("span"),p=e.createElement("i");p.classList.add("step-title"),h.textContent=l+1,""!=this.elems[l].title&&void 0!==this.elems[l].title&&(p.textContent=this.elems[l].title,a.appendChild(p)),a.appendChild(h),a.style.left=100/(this.elems.length-1)*l+"%",n.appendChild(a),r.push(a),a.addEventListener("click",(function(e){t.goToStep(e.target.textContent-1)}),!1)}return i.appendChild(o),s.appendChild(i),s.appendChild(n),s}},{key:"_updateProgressBar",value:function(){if(this.components._elements.progressBar){var t=Array.from(this.components._elements.progressBar.getElementsByTagName("li"));this.components._elements.progressBar.childNodes[0].childNodes[0].style.width=100/(this.elems.length-1)*this.step+"%";for(var e=0;e<=this.elems.length-1;e++)t[e].classList.remove("active","finished");var n=!0,i=!1,o=s;try{for(var r,l=t.slice(0,this.step)[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){r.value.classList.add("finished")}}catch(t){i=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}t[this.step].classList.add("active")}}},{key:"_moveHighlightBox",value:function(){var e=this;if(this.state.running&&this.options.animate)this.state.animating=!0,t.requestAnimationFrame(this._animateHighlightBox.bind(this));else{var s=n.getElementBounds(this.elems[this.step].node),i=s.left-this.options.padding.left;this.components._elements.highlightBox.style.top=s.top+t.scrollY-this.options.padding.top+"px",this.components._elements.highlightBox.style.left=i+"px",this.components._elements.highlightBox.style.right=i+"px",this.components._elements.highlightBox.firstChild.style.height=s.bottom-s.top+2*this.options.padding.top+"px",this.components._elements.highlightBox.firstChild.style.width=s.width+2*this.options.padding.left+"px",this.components._elements.tutorialBox.style.top=s.height+2*this.options.padding.top+6+"px",t.requestAnimationFrame((function(){t.scrollTo(0,s.top-(t.innerHeight-(e.components._elements.tutorialBox.offsetHeight+e.components._elements.highlightBox.firstChild.offsetHeight))/2)}))}this.components._elements.highlightBox.childNodes[1].textContent=this.step+1}},{key:"_animateHighlightBox",value:function(){var t=this,e=this.elems[this.state._firstStep].node,s=this.elems[this.step].node;this._shouldSmoothTutorialboxTransition()&&this.components._elements.tutorialBox.classList.add("hidden"),this.state.transform.translateY=n.getElementBounds(s).top-n.getElementBounds(e).top,this.state.transform.translateX=n.getElementBounds(s).left-n.getElementBounds(e).left,this.components._elements.tutorialBox.style.top=n.getElementBounds(s).height+2*this.options.padding.top+6+"px",this.components._elements.highlightBox.style.transform="translateX("+this.state.transform.translateX+"px) translateY("+this.state.transform.translateY+"px)",this.components._elements.highlightBox.firstChild.style.width=n.getElementBounds(s).width+2*this.options.padding.top+"px",this.components._elements.highlightBox.firstChild.style.height=n.getElementBounds(s).height+2*this.options.padding.top+"px",this._scroll(),this.components._elements.highlightBox.addEventListener("transitionend",(function(){t.state.animating=!1,t._checkAndFixHighlightboxOrientation()}))}},{key:"_updateTutorialBox",value:function(){"normal"===this.elems[this.step].type?("advanced"===this.state.type&&(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.components._elements.tutorialWrapper)),this.components._elements.tutorialText.textContent=this.elems[this.step].text,this.components._elements.tutorialTitle.textContent=this.elems[this.step].title):(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.elems[this.step].template)),this.state.type=this.elems[this.step].type}},{key:"_saveCurrentPosition",value:function(){this.options.advancedStorage?t.localStorage.setItem("tutorial-"+this.name,this.components._step):e.cookie+="tutorial-"+this.name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var s=this;return this.options.advancedStorage?t.localStorage.getItem("tutorial-"+this.name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+s.name)})).map((function(t){return parseInt(t.replace("tutorial-"+s.name+"=",""))}))}},{key:"_getProgressbarHeight",value:function(){return this.components._elements.progressBar.offsetHeight||0}},{key:"_scroll",value:function(){var e=this,s=n.getElementBounds(this.elems[this.step].node).top-(t.innerHeight-(this.components._elements.tutorialBox.offsetHeight+this.components._elements.highlightBox.firstChild.offsetHeight))/2;t.requestAnimationFrame((function(t){e.options.scrolling.timer=t,e.__scrollMovement(t,s)}))}},{key:"_checkAndFixHighlightboxOrientation",value:function(){var s=this.components._elements.progressBar.offsetHeight||0,i=e.body,o=e.documentElement,r=Math.max(i.scrollHeight,i.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight)-s,l=this.components._elements.highlightBox.getBoundingClientRect().top+this.components._elements.highlightBox.offsetHeight+t.scrollY+this.components._elements.tutorialBox.offsetHeight,a=n.getElementBounds(this.elems[this.step].node),h=this.elems[this.step].position;this.components._elements.tutorialBox.classList.remove("north"),this.components._elements.tutorialBox.classList.remove("east"),this.components._elements.tutorialBox.classList.remove("south"),this.components._elements.tutorialBox.classList.remove("west"),this.components._elements.tutorialBox.style.left="",this.components._elements.tutorialBox.style.right="","top"===h||"auto"===h&&l>r?(this.components._elements.tutorialBox.style.top=-(this.components._elements.tutorialBox.offsetHeight+(2*this.options.padding.top-8))+"px",this.components._elements.tutorialBox.classList.add("north")):"bottom"===h||"auto"===h&&l<=r?this.components._elements.tutorialBox.classList.add("south"):"left"===h?(this.components._elements.tutorialBox.style.top=-.5*(this.components._elements.tutorialBox.offsetHeight+(2*this.options.padding.top-100))+"px",this.components._elements.tutorialBox.style.left=-(this.components._elements.tutorialBox.offsetWidth+(2*this.options.padding.left-8))+"px",this.components._elements.tutorialBox.classList.add("west")):"right"===h&&(this.components._elements.tutorialBox.classList.add("east"),this.components._elements.tutorialBox.style.top=-.5*(this.components._elements.tutorialBox.offsetHeight+(2*this.options.padding.top-100))+"px",this.components._elements.tutorialBox.style.right=-(a.width+(2*this.options.padding.left+8))+"px"),this._shouldSmoothTutorialboxTransition()&&this.components._elements.tutorialBox.classList.remove("hidden"),this.last_position=h}},{key:"_shouldSmoothTutorialboxTransition",value:function(){return this.last_position&&this.last_position!=this.elems[this.step].position}},{key:"__load",value:function(){return function(){t.removeEventListener("load",this.components._eventHandler.load),this.start()}.bind(this)}},{key:"__resize",value:function(){return function(){var t=n.getElementBounds(this.elems[this.state._firstStep].node),e=t.left-this.options.padding.left,s=t.top-this.options.padding.top;this.components._elements.highlightBox.classList.add("skip-animation"),this.components._elements.highlightBox.style.left=e+"px",this.components._elements.highlightBox.style.right=e+"px",this.components._elements.highlightBox.style.top=s+"px",this._animateHighlightBox(),this._checkAndFixHighlightboxOrientation(),this.components._elements.highlightBox.classList.remove("skip-animation")}.bind(this)}},{key:"__scrollMovement",value:function(s,i){var o=this,r=s-this.options.scrolling.timer,l=Math.ceil(n.easeOutQuad(r,this.options.scrolling.position,i-this.options.scrolling.position,this.options.scrolling.speed));t.scrollTo(0,l),r<this.options.scrolling.speed?t.requestAnimationFrame((function(t){o.__scrollMovement(t,i)})):(this.options.scrolling.timer=null,this.options.scrolling.position=Math.min(i,e.documentElement.offsetHeight-t.innerHeight))}}],[{key:"installCustomAction",value:function(){var t=arguments.length>0&&arguments[0]!==s?arguments[0]:{},e=t.key,o=e===s?n.mandatory("Identifier"):e,r=t.event,l=r===s?n.mandatory("Event"):r;i.actions.custom.push({key:o,event:l})}}]),i})();l.actions={baseAttributes:{next:l.prototype.next,prev:l.prototype.prev,close:l.prototype.close},custom:[]},t.Tutorial||(t.Tutorial=l)})(window,document);