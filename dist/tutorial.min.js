"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},_createClass=(function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}})();!(function(t,e,n){var s=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}},{key:"easeOutQuad",value:function(t,e,n,s){return-n*(t/=s)*(t-2)+e}},{key:"checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"getElementBounds",value:function(t){var e=t.getBoundingClientRect();return{top:e.top,left:e.left,bottom:e.top+e.height,width:e.width,height:e.height}}}]),t})(),i=function t(e,n,s){_classCallCheck(this,t),this.node=n,Object.keys(s).length||"function"==typeof s?s.once?this.callback=function(){this.run||(s.fn.call(this,e),this.run=!0)}:this.callback=(s.fn||s).bind(this,e):this.callback=function(){}},o=(function(t){function e(t,s,i){var o=arguments.length>3&&arguments[3]!==n?arguments[3]:{},r=o.title,l=r===n?"":r,a=o.callback,h=a===n?{}:a;_classCallCheck(this,e);var c=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,h));return c.type="normal",c.text=i,c.title=l,c}return _inherits(e,t),e})(i),r=(function(t){function s(t,i,o){var r=arguments.length>3&&arguments[3]!==n?arguments[3]:{},l=r.callback,a=l===n?{}:l;_classCallCheck(this,s);var h=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,i,a));return h.type="advanced",h.template=e.getElementById(o.substr(1)).childNodes[0].data,h}return _inherits(s,t),s})(i),l=(function(){function i(){var l=this,a=arguments.length>0&&arguments[0]!==n?arguments[0]:s.mandatory("Name"),h=arguments[1],c=h.selector,p=c===n?"tut-action":c,u=h.steps,d=u===n?[]:u,m=h.persistent,g=m!==n&&m,f=h.buttons,v=f===n?{}:f,_=h.padding,y=_===n?{}:_,x=h.debug,b=x!==n&&x,B=h.autoplay,C=B!==n&&B,k=h.scrollSpeed,E=k===n?800:k,L=h.animate,w=L===n||L,H=h.progressbar,S=H!==n&&H;if(_classCallCheck(this,i),this.elems=[],d.length>0){var A=!0,O=!1,P=n;try{for(var T,N=d[Symbol.iterator]();!(A=(T=N.next()).done);A=!0){var j=T.value,I=e.querySelector(j.highlight);if(!I)throw new Error("Selector "+j.highlight+" not found.");if(j.hasOwnProperty("action")){var F=new r(this,I,j.action.template);F.template=this._parseAdvancedStep(F),F.template.classList.add("custom-box"),this.elems.push(F)}else this.elems.push(new o(this,I,j.text,{title:j.title,callback:j.callback}))}}catch(t){O=!0,P=t}finally{try{!A&&N.return&&N.return()}finally{if(O)throw P}}}else{var z=Array.from(e.getElementsByClassName(p));if(!z.every((function(t){return t.getAttribute("t-step")}))||!z.every((function(t){return t.getAttribute("t-text")})))throw new Error("Not all steps or texts defined");z.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))})),this.elems=z.map((function(t){return new o(l,t,t.getAttribute("t-text"),{title:t.getAttribute("t-title")})}))}if(0===this.elems.length)throw new Error("No activities point defined");this.name=a,this.buttonText={},this.options={selector:p,persistent:g,advancedStorage:s.checkStorageSupport(),scrolling:{speed:E,timer:null,position:0},padding:{top:y.top===n?12:v.close,left:y.left===n?12:v.close},buttons:{previous:v.previous===n?"Back":v.previous,next:v.next===n?"Next":v.next},animate:w,debug:b};var M=this._getCurrentPosition()||0;this.state={running:!1,completed:-1===M,animation:!1,transform:{translateY:0,translateX:0},type:this.elems[0].type,_firstStep:parseInt(this.options.persistent?M:0)},this.components={_step:parseInt(this.options.persistent?M:0),_eventHandler:{load:this.__load(),resize:this.__resize()},_elements:_extends({progressBar:!!S&&this._createProgressbar(),blur:this._createBlurElement()},this._createTutorialBox())},this.components._elements.highlightBox=this._createHighlightBox(this.components._elements.tutorialBox),Object.defineProperty(this,"step",{get:function(){return l.components._step},set:function(t){l.state.running&&(l.animating||(t<0&&l.close(),t===l.elems.length?(l.close(),l.components._step=-1):(l.elems[l.components._step].node.classList.remove("tutorial-highlight"),l.components._step=t,l.elems[t].node.classList.add("tutorial-highlight"),l._updateTutorialBox(),l._updateProgressBar(),l._moveHighlightBox()),l.options.persistent&&l._saveCurrentPosition()))}}),C&&t.addEventListener("load",this.components._eventHandler.load)}return _createClass(i,[{key:"start",value:function(){this.options.debug,this.state.running||-1===this.step||(this.elems[this.step].node.classList.add("tutorial-highlight"),e.body.appendChild(this.components._elements.blur),e.body.appendChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.appendChild(this.components._elements.progressBar),this._moveHighlightBox(),this._updateTutorialBox(),this._updateProgressBar(),this._checkAndFixHighlightboxOrientation(),this.state.running=!0,t.addEventListener("resize",this.components._eventHandler.resize))}},{key:"close",value:function(){this.state.running&&(this.state.running=!1,this.elems[this.step].node.classList.remove("tutorial-highlight"),this.components._elements.highlightBox.style.transform="",this.components._elements.highlightBox.firstChild.style.transform="",e.body.removeChild(this.components._elements.blur),e.body.removeChild(this.components._elements.highlightBox),this.components._elements.progressBar&&e.body.removeChild(this.components._elements.progressBar),t.removeEventListener("resize",this.components._eventHandler.resize))}},{key:"prev",value:function(){this.step--,this.options.debug}},{key:"next",value:function(){this.elems[this.step].callback(),this.step++,this.options.debug}},{key:"goToStep",value:function(t){if(this.state.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.step=t)}}},{key:"reset",value:function(){this.components._step=0,this.state._firstStep=0,this.state.transform.translateX=0,this.state.transform.translateY=0}},{key:"_parseAdvancedStep",value:function(s){var o=this,r=e.createElement("div"),l=i.actions.baseAttributes,a=i.actions.custom;r.insertAdjacentHTML("afterbegin",s.template);var h=!0,c=!1,p=n;try{for(var u,d=r.getElementsByTagName("*")[Symbol.iterator]();!(h=(u=d.next()).done);h=!0){var m=u.value,g=!0,f=!1,v=n;try{for(var _,y=Object.entries(l)[Symbol.iterator]();!(g=(_=y.next()).done);g=!0)!(function(){var t=_.value;Array.from(m.attributes).some((function(e){return e.name.includes(t[0])}))&&m.addEventListener("click",(function(){t[1].call(o)}))})()}catch(t){f=!0,v=t}finally{try{!g&&y.return&&y.return()}finally{if(f)throw v}}var x=!0,b=!1,B=n;try{for(var C,k=a[Symbol.iterator]();!(x=(C=k.next()).done);x=!0){var E=C.value,L=!0,w=!1,H=n;try{for(var S,A=Array.from(m.attributes)[Symbol.iterator]();!(L=(S=A.next()).done);L=!0)!(function(){var e=S.value;e.name.includes(E.key)&&m.addEventListener(E.event,(function(){t[e.value]()}))})()}catch(t){w=!0,H=t}finally{try{!L&&A.return&&A.return()}finally{if(w)throw H}}}}catch(t){b=!0,B=t}finally{try{!x&&k.return&&k.return()}finally{if(b)throw B}}}}catch(t){c=!0,p=t}finally{try{!h&&d.return&&d.return()}finally{if(c)throw p}}return r}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,n=e.createElement("div");return n.classList.add("tutorial-blur"),n.addEventListener("click",(function(e){t.close()})),n}},{key:"_createHighlightBox",value:function(t){var n=e.createElement("div"),s=n.cloneNode(),i=e.createElement("i");return n.classList.add("tutorial-wrapper"),s.classList.add("tutorial-background"),i.classList.add("tutorial-index"),n.addEventListener("click",(function(t){t.stopPropagation()})),n.appendChild(s),n.appendChild(i),n.appendChild(t),n}},{key:"_createTutorialBox",value:function(){var t=this,n=e.createElement("div"),s=n.cloneNode(!1),i=e.createElement("p"),o=e.createElement("p"),r=o.cloneNode(),l=n.cloneNode(!1),a=n.cloneNode(!1),h=e.createElement("a");h.href="#";var c=h.cloneNode(!1),p=h.cloneNode(!1);return n.classList.add("tutorial-box"),s.classList.add("tutorial-box-wrapper"),i.classList.add("tutorial-title"),o.classList.add("tutorial-description"),r.classList.add("tutorial-step-position"),l.classList.add("tutorial-buttons"),p.classList.add("tutorial-close"),h.textContent=this.options.buttons.previous,c.textContent=this.options.buttons.next,p.addEventListener("click",(function(e){t.close()}),!1),h.addEventListener("click",(function(e){t.prev()}),!1),c.addEventListener("click",(function(e){t.next()}),!1),Object.defineProperties(this.buttonText,{next:{get:function(){return t.options.buttons.next},set:function(e){t.options.buttons.next=e,c.textContent=e}},prev:{get:function(){return t.options.buttons.previous},set:function(e){t.options.buttons.previous=e,h.textContent=e}}}),l.appendChild(r),l.appendChild(p),l.appendChild(a),a.appendChild(h),a.appendChild(c),s.appendChild(i),s.appendChild(o),s.appendChild(l),n.appendChild(s),{tutorialBox:n,tutorialWrapper:s,tutorialTitle:i,tutorialText:o,tutorialPosition:r,tutorialButtonNext:c,tutorialButtonPrev:h}}},{key:"_createProgressbar",value:function(){var t=this,n=e.createElement("div"),s=e.createElement("ul"),i=e.createElement("div"),o=e.createElement("span");n.classList.add("progressbar-wrapper"),i.classList.add("progressbar-track");for(var r=[],l=0;l<=this.elems.length-1;l++){var a=e.createElement("li"),h=e.createElement("span"),c=e.createElement("i");c.classList.add("step-title"),h.textContent=l+1,""!=this.elems[l].title&&(c.textContent=this.elems[l].title,a.appendChild(c)),a.appendChild(h),a.style.left=100/(this.elems.length-1)*l+"%",s.appendChild(a),r.push(a),a.addEventListener("click",(function(e){t.goToStep(e.target.textContent-1)}),!1)}return i.appendChild(o),n.appendChild(i),n.appendChild(s),n}},{key:"_updateProgressBar",value:function(){if(this.components._elements.progressBar){var t=Array.from(this.components._elements.progressBar.getElementsByTagName("li"));this.components._elements.progressBar.childNodes[0].childNodes[0].style.width=100/(this.elems.length-1)*this.step+"%";for(var e=0;e<=this.elems.length-1;e++)t[e].classList.remove("active","finished");var s=!0,i=!1,o=n;try{for(var r,l=t.slice(0,this.step)[Symbol.iterator]();!(s=(r=l.next()).done);s=!0){r.value.classList.add("finished")}}catch(t){i=!0,o=t}finally{try{!s&&l.return&&l.return()}finally{if(i)throw o}}t[this.step].classList.add("active")}}},{key:"_moveHighlightBox",value:function(){var e=this;if(this.state.running&&this.options.animate)this.state.animating=!0,t.requestAnimationFrame(this._animateHighlightBox.bind(this));else{var n=s.getElementBounds(this.elems[this.step].node),i=n.left-this.options.padding.left;this.components._elements.highlightBox.style.top=n.top+t.scrollY-this.options.padding.top,this.components._elements.highlightBox.style.left=i,this.components._elements.highlightBox.style.right=i,this.components._elements.highlightBox.firstChild.style.height=n.bottom-n.top+2*this.options.padding.top,this.components._elements.highlightBox.firstChild.style.width=n.width+2*this.options.padding.left,this.components._elements.tutorialBox.style.top=n.height+2*this.options.padding.top+6+"px",t.requestAnimationFrame((function(){t.scrollTo(0,n.top-(t.innerHeight-(e.components._elements.tutorialBox.offsetHeight+e.components._elements.highlightBox.firstChild.offsetHeight))/2)}))}this.components._elements.highlightBox.childNodes[1].textContent=this.step+1}},{key:"_animateHighlightBox",value:function(){var t=this,e=this.elems[this.state._firstStep].node,n=this.elems[this.step].node;this.state.transform.translateY=s.getElementBounds(n).top-s.getElementBounds(e).top,this.state.transform.translateX=s.getElementBounds(n).left-s.getElementBounds(e).left,this.components._elements.tutorialBox.style.top=s.getElementBounds(n).height+2*this.options.padding.top+6+"px",this.components._elements.highlightBox.style.transform="translateX("+this.state.transform.translateX+"px) translateY("+this.state.transform.translateY+"px)",this.components._elements.highlightBox.firstChild.style.width=s.getElementBounds(n).width+2*this.options.padding.top,this.components._elements.highlightBox.firstChild.style.height=s.getElementBounds(n).height+2*this.options.padding.top,this._scroll(),this.components._elements.highlightBox.addEventListener("transitionend",(function(){t.state.animating=!1,t._checkAndFixHighlightboxOrientation()}))}},{key:"_updateTutorialBox",value:function(){"normal"===this.elems[this.step].type?("advanced"===this.state.type&&(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.components._elements.tutorialWrapper)),this.components._elements.tutorialText.textContent=this.elems[this.step].text,this.components._elements.tutorialTitle.textContent=this.elems[this.step].title):(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.elems[this.step].template)),this.state.type=this.elems[this.step].type}},{key:"_saveCurrentPosition",value:function(){this.options.advancedStorage?t.localStorage.setItem("tutorial-"+this.name,this.components._step):e.cookie+="tutorial-"+this.name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var n=this;return this.options.advancedStorage?t.localStorage.getItem("tutorial-"+this.name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+n.name)})).map((function(t){return parseInt(t.replace("tutorial-"+n.name+"=",""))}))}},{key:"_getProgressbarHeight",value:function(){return this.components._elements.progressBar.offsetHeight||0}},{key:"_scroll",value:function(){var e=this,n=s.getElementBounds(this.elems[this.step].node).top-(t.innerHeight-(this.components._elements.tutorialBox.offsetHeight+this.components._elements.highlightBox.firstChild.offsetHeight))/2;t.requestAnimationFrame((function(t){e.options.scrolling.timer=t,e.__scrollMovement(t,n)}))}},{key:"_checkAndFixHighlightboxOrientation",value:function(){var n=this.components._elements.progressBar.offsetHeight||0,s=e.body,i=e.documentElement,o=Math.max(s.scrollHeight,s.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight)-n;this.components._elements.highlightBox.getBoundingClientRect().top+this.components._elements.highlightBox.offsetHeight+t.scrollY+this.components._elements.tutorialBox.offsetHeight>o?(this.components._elements.tutorialBox.style.top=-(this.components._elements.tutorialBox.offsetHeight+(2*this.options.padding.top-8)),this.components._elements.tutorialBox.classList.add("north"),this.components._elements.tutorialBox.classList.remove("south")):(this.components._elements.tutorialBox.classList.add("south"),this.components._elements.tutorialBox.classList.remove("north"))}},{key:"__load",value:function(){return function(){t.removeEventListener("load",this.components._eventHandler.load),this.start()}.bind(this)}},{key:"__resize",value:function(){return function(){var t=s.getElementBounds(this.elems[this.state._firstStep].node).left-this.options.padding.left;this.components._elements.highlightBox.classList.add("skip-animation"),this.components._elements.highlightBox.style.left=t,this.components._elements.highlightBox.style.right=t,this.components._elements.highlightBox.style.top=s.getElementBounds(this.elems[this.state._firstStep].node).top-this.options.padding.top,this._animateHighlightBox(),this._checkAndFixHighlightboxOrientation(),this.components._elements.highlightBox.classList.remove("skip-animation")}.bind(this)}},{key:"__scrollMovement",value:function(n,i){var o=this,r=n-this.options.scrolling.timer,l=Math.ceil(s.easeOutQuad(r,this.options.scrolling.position,i-this.options.scrolling.position,this.options.scrolling.speed));t.scrollTo(0,l),r<this.options.scrolling.speed?t.requestAnimationFrame((function(t){o.__scrollMovement(t,i)})):(this.options.scrolling.timer=null,this.options.scrolling.position=Math.min(i,e.documentElement.offsetHeight-t.innerHeight))}}],[{key:"installCustomAction",value:function(){var t=arguments.length>0&&arguments[0]!==n?arguments[0]:{},e=t.key,o=e===n?s.mandatory("Identifier"):e,r=t.event,l=r===n?s.mandatory("Event"):r;i.actions.custom.push({key:o,event:l})}}]),i})();l.actions={baseAttributes:{next:l.prototype.next,prev:l.prototype.prev,close:l.prototype.close},custom:[]},t.Tutorial||(t.Tutorial=l)})(window,document);