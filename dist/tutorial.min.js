"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},_createClass=(function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}})();!(function(t,e,i){var n=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}},{key:"easeOutQuad",value:function(t,e,i,n){return-i*(t/=n)*(t-2)+e}},{key:"checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"getElementBounds",value:function(t){return{top:t.offsetTop,left:t.offsetLeft,bottom:t.offsetTop+t.offsetHeight,width:t.offsetWidth,height:t.offsetHeight}}}]),t})(),s=function t(e,i){_classCallCheck(this,t),this.node=e,Object.keys(i).length||"function"==typeof i?i.once?this.callback=function(){this.run||(i.fn(),this.run=!0)}:this.callback=i.fn||i:this.callback=function(){}},o=(function(t){function e(t,n){var s=arguments.length>2&&arguments[2]!==i?arguments[2]:{},o=s.title,l=o===i?"":o,r=s.callback,a=r===i?{}:r;_classCallCheck(this,e);var h=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a));return h.type="normal",h.text=n,h.title=l,h}return _inherits(e,t),e})(s),l=(function(t){function n(t,s){var o=(arguments.length>2&&arguments[2]!==i?arguments[2]:{}).callback,l=o===i?{}:o;_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,l));return r.type="advanced",r.template=e.getElementById(s.substr(1)).childNodes[0].data,r}return _inherits(n,t),n})(s),r=(function(){function r(){var a=this,h=arguments.length>0&&arguments[0]!==i?arguments[0]:n.mandatory("Name"),c=arguments[1],u=c.selector,p=u===i?"tut-action":u,d=c.steps,m=d===i?[]:d,f=c.persistent,g=f!==i&&f,v=c.buttons,_=v===i?{}:v,y=c.padding,b=y===i?{}:y,x=c.debug,k=x!==i&&x,B=c.autoplay,C=B!==i&&B,E=c.scrollSpeed,L=E===i?800:E,w=c.animate,H=w===i||w;if(_classCallCheck(this,r),this.elems=[],m.length>0){var T=!0,S=!1,N=i;try{for(var O,A=m[Symbol.iterator]();!(T=(O=A.next()).done);T=!0){var P=O.value,j=e.querySelector(P.highlight);if(!j)throw new Error("Selector "+P.highlight+" not found.");if(P.hasOwnProperty("action")){var I=new l(j,P.action.template);I.template=this._parseAdvancedStep(I),this.elems.push(I)}else this.elems.push(new o(j,P.text,{title:P.title,callback:P.callback}))}}catch(t){S=!0,N=t}finally{try{!T&&A.return&&A.return()}finally{if(S)throw N}}}else{var Y=Array.from(e.getElementsByClassName(p));if(!Y.every((function(t){return t.getAttribute("t-step")}))||!Y.every((function(t){return t.getAttribute("t-text")})))throw new Error("Not all steps or texts defined");Y.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))})),this.elems=Y.map((function(t){return new s(t,t.getAttribute("t-text"),{title:t.getAttribute("t-title")})}))}if(0===this.elems.length)throw new Error("No activities point defined");this.name=h,this.options={selector:p,persistent:g,advancedStorage:n.checkStorageSupport(),scrolling:{speed:L,timer:null,position:t.scrollY},padding:{top:b.top===i?12:_.close,left:b.left===i?12:_.close},buttons:{previous:_.previous===i?"Back":_.close,next:_.next===i?"Next":_.close},animate:H,debug:k},this.state={running:!1,animation:!1},this.components={_step:parseInt(this.options.persistent?this._getCurrentPosition()||0:0),_eventHandler:{load:this.__load(),resize:this.__resize()},_elements:_extends({blur:this._createBlurElement()},this._createTutorialBox())},this.components._elements.highlightBox=this._createHighlightBox(this.components._elements.tutorialBox),this._reset(),Object.defineProperty(this,"step",{get:function(){return a.components._step},set:function(t){a.components._step=t,a.options.persistent&&a._saveCurrentPosition()}}),C&&t.addEventListener("load",this.components._eventHandler.load)}return _createClass(r,[{key:"start",value:function(){this.options.debug,this.state.running||(this.elems[this.step].node.classList.add("tutorial-highlight"),e.body.appendChild(this.components._elements.blur),e.body.appendChild(this.components._elements.highlightBox),this._moveHighlightBox(),this._updateTutorialBox(),this.state.running=!0,t.addEventListener("resize",this.components._eventHandler.resize))}},{key:"close",value:function(){this.state.running&&(this.elems[this.step].node.classList.remove("tutorial-highlight"),this.components._elements.highlightBox.style.transform="",this.components._elements.highlightBox.childNodes[0].style.transform="",e.body.removeChild(this.components._elements.blur),e.body.removeChild(this.components._elements.highlightBox),t.removeEventListener("resize",this.components._eventHandler.resize),this._reset())}},{key:"prev",value:function(){this.state.running&&(this.animating||(this.options.debug,0!==this.step?(this.elems[this.step].node.classList.remove("tutorial-highlight"),this.elems[--this.step].node.classList.add("tutorial-highlight"),this._moveHighlightBox(),this._updateTutorialBox()):this.close()))}},{key:"next",value:function(){this.state.running&&(this.animating||(this.options.debug,this.elems[this.step].callback(),this.step!==this.elems.length-1?(this.elems[this.step].node.classList.remove("tutorial-highlight"),this.elems[++this.step].node.classList.add("tutorial-highlight"),this._moveHighlightBox(),this._updateTutorialBox()):this.close()))}},{key:"goToStep",value:function(t){if(this.state.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.elems[this.step].node.classList.remove("tutorial-highlight"),this.step=t,this.elems[this.step].node.classList.add("tutorial-highlight"))}}},{key:"_parseAdvancedStep",value:function(t){var n=this,s=e.createElement("div"),o=r.actions.baseAttributes;s.insertAdjacentHTML("afterbegin",t.template);var l=!0,a=!1,h=i;try{for(var c,u=s.getElementsByTagName("*")[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var p=c.value,d=!0,m=!1,f=i;try{for(var g,v=Object.entries(o)[Symbol.iterator]();!(d=(g=v.next()).done);d=!0)!(function(){var t=g.value;Array.from(p.attributes).some((function(e){return e.name.includes(t[0])}))&&p.addEventListener("click",(function(){t[1].call(n)}))})()}catch(t){m=!0,f=t}finally{try{!d&&v.return&&v.return()}finally{if(m)throw f}}}}catch(t){a=!0,h=t}finally{try{!l&&u.return&&u.return()}finally{if(a)throw h}}return s}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,i=e.createElement("div");return i.classList.add("tutorial-blur"),i.addEventListener("click",(function(e){t.close()})),i}},{key:"_createHighlightBox",value:function(t){var i=e.createElement("div"),n=i.cloneNode(),s=e.createElement("i");return i.classList.add("tutorial-wrapper"),n.classList.add("tutorial-background"),s.classList.add("tutorial-index"),i.addEventListener("click",(function(t){t.stopPropagation()})),i.appendChild(n),i.appendChild(s),i.appendChild(t),i}},{key:"_createTutorialBox",value:function(){var t=this,i=e.createElement("div"),n=i.cloneNode(!1),s=e.createElement("p"),o=e.createElement("p"),l=o.cloneNode(),r=i.cloneNode(!1),a=i.cloneNode(!1),h=e.createElement("a");h.href="#";var c=h.cloneNode(!1),u=h.cloneNode(!1);return i.classList.add("tutorial-box"),n.classList.add("tutorial-box-wrapper"),s.classList.add("tutorial-title"),o.classList.add("tutorial-description"),l.classList.add("tutorial-step-position"),r.classList.add("tutorial-buttons"),u.classList.add("tutorial-close"),h.textContent=this.options.buttons.previous,c.textContent=this.options.buttons.next,u.addEventListener("click",(function(e){t.close()}),!1),h.addEventListener("click",(function(e){t.prev()}),!1),c.addEventListener("click",(function(e){t.next()}),!1),r.appendChild(l),r.appendChild(u),r.appendChild(a),a.appendChild(h),a.appendChild(c),n.appendChild(s),n.appendChild(o),n.appendChild(r),i.appendChild(n),{tutorialBox:i,tutorialTitle:s,tutorialText:o,tutorialPosition:l}}},{key:"_moveHighlightBox",value:function(){if(this.state.running&&this.options.animate)this.state.animating=!0,t.requestAnimationFrame(this._animateHighlightBox.bind(this));else{var e=n.getElementBounds(this.elems[this.step].node),i=e.top+e.height+this.components._elements.tutorialBox.offsetHeight+2*this.options.padding.top;this.components._elements.highlightBox.style.top=e.top-this.options.padding.top,this.components._elements.highlightBox.style.left=e.left-this.options.padding.left,this.components._elements.highlightBox.childNodes[0].style.height=e.bottom-e.top+2*this.options.padding.top,this.components._elements.highlightBox.childNodes[0].style.width=e.width+2*this.options.padding.left,this.components._elements.tutorialBox.style.top=e.height+2*this.options.padding.top+6+"px",t.requestAnimationFrame((function(){t.scrollTo(0,i-(t.scrollY+t.innerHeight+t.scrollY))}))}this.components._elements.highlightBox.childNodes[1].textContent=this.step+1}},{key:"_animateHighlightBox",value:function(){var e=this,i=this.elems[0].node,n=this.elems[this.step].node;this.state.transform.translateY=n.offsetTop-i.offsetTop,this.state.transform.translateX=n.offsetLeft-i.offsetLeft,this.components._elements.tutorialBox.style.top=n.offsetHeight+2*this.options.padding.top+6+"px",this.components._elements.highlightBox.style.transform="translateX("+this.state.transform.translateX+"px) translateY("+this.state.transform.translateY+"px)",this.components._elements.highlightBox.childNodes[0].style.width=n.offsetWidth+2*this.options.padding.top,this.components._elements.highlightBox.childNodes[0].style.height=n.offsetHeight+2*this.options.padding.top,t.scrollY+t.innerHeight<n.offsetTop+n.offsetHeight+this.components._elements.tutorialBox.offsetHeight+2*this.options.padding.top&&this._scroll(),this.components._elements.highlightBox.addEventListener("transitionend",(function(){e.state.animating=!1}))}},{key:"_updateTutorialBox",value:function(){"normal"===this.elems[this.step].type?(this.components._elements.tutorialText.textContent=this.elems[this.step].text,this.components._elements.tutorialTitle.textContent=this.elems[this.step].title):(this.components._elements.tutorialBox.firstChild.remove(),this.components._elements.tutorialBox.appendChild(this.elems[this.step].template))}},{key:"_saveCurrentPosition",value:function(){this.options.advancedStorage?t.localStorage.setItem("tutorial-"+this.name,this.step):e.cookie+="tutorial-"+this.name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var i=this;return this.options.advancedStorage?t.localStorage.getItem("tutorial-"+this.name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+i.name)})).map((function(t){return parseInt(t.replace("tutorial-"+i.name+"=",""))}))}},{key:"_scroll",value:function(){var e=this,i=n.getElementBounds(this.components._elements.tutorialBox),s=n.getElementBounds(this.elems[this.step].node),o=s.top+s.height+i.height+2*this.options.padding.top;t.requestAnimationFrame((function(t){e.options.scrolling.timer=t,e.__scrollMovement(t,o)}))}},{key:"_reset",value:function(){this.step=0,this.state.running=!1,this.state.transform={translateY:0,translateX:0}}},{key:"__load",value:function(){return function(){t.removeEventListener("load",this.components._eventHandler.load),this.start()}.bind(this)}},{key:"__resize",value:function(){return function(){this.components._elements.highlightBox.classList.add("skip-animation"),this.components._elements.highlightBox.style.left=this.elems[0].node.offsetLeft-this.options.padding.left,this.components._elements.highlightBox.style.top=this.elems[0].node.offsetTop-this.options.padding.top,this._animateHighlightBox(),this.components._elements.highlightBox.classList.remove("skip-animation")}.bind(this)}},{key:"__scrollMovement",value:function(e,i){var s=this,o=e-this.options.scrolling.timer,l=Math.ceil(n.easeOutQuad(o,this.options.scrolling.position,i-t.innerHeight-this.options.scrolling.position,this.options.scrolling.speed));i!==t.innerHeight+t.scrollY&&t.scrollTo(0,l),o<this.options.scrolling.speed?t.requestAnimationFrame((function(t){s.__scrollMovement(t,i)})):(this.options.scrolling.position=t.scrollY,this.options.scrolling.timer=null)}}],[{key:"installCustomAction",value:function(){var t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},e=t.key,s=e===i?n.mandatory("Identifier"):e,o=t.action,l=o===i?n.mandatory("Function"):o,a=t.event,h=a===i?n.mandatory("Event"):a;r.actions.custom.push({key:s,action:l,event:h})}}]),r})();r.actions={baseAttributes:{next:r.prototype.next,prev:r.prototype.prev,close:r.prototype.close},custom:[]},t.Tutorial||(t.Tutorial=r)})(window,document);