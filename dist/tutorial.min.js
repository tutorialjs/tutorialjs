"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=(function(){function t(t,e){var i=[],s=!0,n=!1,o=void 0;try{for(var l,r=t[Symbol.iterator]();!(s=(l=r.next()).done)&&(i.push(l.value),!e||i.length!==e);s=!0);}catch(t){n=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(n)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),_createClass=(function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}})();!(function(t,e,i){var s=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}},{key:"easeOutQuad",value:function(t,e,i,s){return-i*(t/=s)*(t-2)+e}},{key:"checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"getElementBounds",value:function(t){return{top:t.offsetTop,left:t.offsetLeft,bottom:t.offsetTop+t.offsetHeight,width:t.offsetWidth,height:t.offsetHeight}}}]),t})(),n=function t(e,s,n){var o=n.title,l=o===i?"":o,r=n.callback,a=r===i?{}:r;_classCallCheck(this,t),this.type="normal",this.node=e,this.text=s,this.title=l,Object.keys(a).length||"function"==typeof a?a.once?this.callback=function(){this.run||(a.fn(),this.run=!0)}:this.callback=a.fn||a:this.callback=function(){}},o=function t(i){_classCallCheck(this,t),this.type="advanced",this.html=e.getElementById(i.substr(1)).childNodes},l=(function(){function l(){var r=this,a=arguments.length>0&&arguments[0]!==i?arguments[0]:s.mandatory("Name"),h=arguments[1],u=h.selector,c=u===i?"tut-action":u,d=h.steps,g=d===i?[]:d,p=h.persistent,f=p!==i&&p,_=h.buttons,m=_===i?{}:_,v=h.padding,y=v===i?{}:v,x=h.debug,b=x!==i&&x,k=h.autoplay,B=k!==i&&k,C=h.scrollSpeed,E=C===i?500:C;if(_classCallCheck(this,l),this.elems=[],g.length>0){var w=!0,L=!1,T=i;try{for(var H,S=g[Symbol.iterator]();!(w=(H=S.next()).done);w=!0){var N=H.value;N.hasOwnProperty("action")?new o(N.highlight):this.elems.push(this._createTutorialSteps(N))}}catch(t){L=!0,T=t}finally{try{!w&&S.return&&S.return()}finally{if(L)throw T}}}else{var A=Array.from(e.getElementsByClassName(c));if(!A.every((function(t){return t.getAttribute("t-step")}))||!A.every((function(t){return t.getAttribute("t-text")})))throw new Error("Not all steps or texts defined");A.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))})),this.elems=A.map((function(t){return new n(t,t.getAttribute("t-text"),{title:t.getAttribute("t-title")})}))}if(0===this.elems.length)throw new Error("No activities point defined");this._reset(),this._name=a,this._persistent=f,this._advancedStorage=s.checkStorageSupport(),this._step=parseInt(this._persistent?this._getCurrentPosition()||0:0),this._scrolling={speed:E,timer:null,position:t.scrollY},this._padding={top:y.top===i?12:m.close,left:y.left===i?12:m.close},this._eventHandler={load:this.__load(),resize:this.__resize()},this.selector=c,this.animate=!0,this.animating=!1,this.buttons={previous:m.previous===i?"Back":m.close,next:m.next===i?"Next":m.close},this.debug=b,this._body=e.body,this._blurElement=this._createBlurElement();var I=this._createTutorialBox(),P=_slicedToArray(I,4);this._tutorialBox=P[0],this._tutorialTitle=P[1],this._tutorialText=P[2],this._tutorialPosition=P[3],this._highlightBox=this._createHighlightBox(this._tutorialBox),Object.defineProperty(this,"step",{get:function(){return r._step},set:function(t){r._step=t,r._persistent&&r._saveCurrentPosition()}}),B&&t.addEventListener("load",this._eventHandler.load)}return _createClass(l,[{key:"start",value:function(){this.debug,this.running||(this.elems[this.step].node.classList.add("tutorial-highlight"),this._body.appendChild(this._blurElement),this._body.appendChild(this._highlightBox),this._moveHighlightBox(),this._updateTutorialBox(),this.running=!0,t.addEventListener("resize",this._eventHandler.resize))}},{key:"close",value:function(){this.running&&(this.elems[this.step].node.classList.remove("tutorial-highlight"),this._highlightBox.style.transform="",this._highlightBox.childNodes[0].style.transform="",this._body.removeChild(this._blurElement),this._body.removeChild(this._highlightBox),t.removeEventListener("resize",this._eventHandler.resize),this._reset())}},{key:"prev",value:function(){if(this.running&&!this.animating){if(this.debug,0===this.step)return void this.close();this.elems[this.step].node.classList.remove("tutorial-highlight"),this.elems[--this.step].node.classList.add("tutorial-highlight"),this._moveHighlightBox(),this._updateTutorialBox()}}},{key:"next",value:function(){if(this.running&&!this.animating){if(this.debug,this.elems[this.step].callback(),this.step===this.elems.length-1)return void this.close();this.elems[this.step].node.classList.remove("tutorial-highlight"),this.elems[++this.step].node.classList.add("tutorial-highlight"),this._moveHighlightBox(),this._updateTutorialBox()}}},{key:"goToStep",value:function(t){if(this.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.elems[this.step].node.classList.remove("tutorial-highlight"),this.step=t,this.elems[this.step].node.classList.add("tutorial-highlight"))}}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,i=e.createElement("div");return i.classList.add("tutorial-blur"),i.onclick=function(){t.close()},i}},{key:"_createHighlightBox",value:function(t){var i=e.createElement("div"),s=e.createElement("div"),n=e.createElement("i");return i.classList.add("tutorial-wrapper"),s.classList.add("tutorial-background"),n.classList.add("tutorial-index"),i.onlick=function(t){t.preventPropagation()},i.appendChild(s),i.appendChild(n),i.appendChild(t),i}},{key:"_createTutorialBox",value:function(){var t=this,i=e.createElement("div"),s=i.cloneNode(!1),n=e.createElement("p"),o=e.createElement("p"),l=o.cloneNode(),r=i.cloneNode(!1),a=i.cloneNode(!1),h=e.createElement("a");h.href="#";var u=h.cloneNode(!1),c=h.cloneNode(!1);return i.classList.add("tutorial-box"),s.classList.add("tutorial-box-wrapper"),n.classList.add("tutorial-title"),o.classList.add("tutorial-description"),l.classList.add("tutorial-step-position"),r.classList.add("tutorial-buttons"),c.classList.add("tutorial-close"),h.textContent=this.buttons.previous,u.textContent=this.buttons.next,c.onclick=function(e){e.preventDefault(),t.close()},h.onclick=function(e){e.preventDefault(),t.prev()},u.onclick=function(e){e.preventDefault(),t.next()},r.appendChild(l),r.appendChild(c),r.appendChild(a),a.appendChild(h),a.appendChild(u),s.appendChild(n),s.appendChild(o),s.appendChild(r),i.appendChild(s),[i,n,o,l]}},{key:"_moveHighlightBox",value:function(){if(this.running&&this.animate)this.animating=!0,this._animateHighlightBox();else{var t=s.getElementBounds(this.elems[this.step].node);this._highlightBox.style.top=t.top-this._padding.top,this._highlightBox.style.left=t.left-this._padding.left,this._highlightBox.childNodes[0].style.height=t.bottom-t.top+2*this._padding.top,this._highlightBox.childNodes[0].style.width=t.width+2*this._padding.left,this._tutorialBox.style.top=t.height+2*this._padding.top+6+"px"}this._highlightBox.childNodes[1].textContent=this.step+1}},{key:"_animateHighlightBox",value:function(){var e=this,i=this.elems[0].node,s=this.elems[this.step].node;this._transform.translateY=s.offsetTop-i.offsetTop,this._transform.translateX=s.offsetLeft-i.offsetLeft,this._tutorialBox.style.top=s.offsetHeight+2*this._padding.top+6+"px",this._highlightBox.style.transform="translateX("+this._transform.translateX+"px) translateY("+this._transform.translateY+"px)",this._highlightBox.childNodes[0].style.width=s.offsetWidth+2*this._padding.top,this._highlightBox.childNodes[0].style.height=s.offsetHeight+2*this._padding.top,t.requestAnimationFrame((function(t){e._scroll(t)})),this._highlightBox.addEventListener("transitionend",(function(){e.animating=!1}))}},{key:"_updateTutorialBox",value:function(){this._tutorialText.textContent=this.elems[this.step].text,this._tutorialTitle.textContent=this.elems[this.step].title}},{key:"_saveCurrentPosition",value:function(){this._advancedStorage?t.localStorage.setItem("tutorial-"+this._name,this.step):e.cookie+="tutorial-"+this._name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var i=this;return this._advancedStorage?t.localStorage.getItem("tutorial-"+this._name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+i._name)})).map((function(t){return parseInt(t.replace("tutorial-"+i._name+"=",""))}))}},{key:"_scroll",value:function(e){var i=this,n=s.getElementBounds(this._tutorialBox),o=s.getElementBounds(this.elems[this.step].node);this._scrolling.timer||(this._scrolling.timer=e,this._scrolling.position=t.scrollY);var l=e-this._scrolling.timer,r=o.top+o.height+n.height+2*this._padding.top,a=Math.ceil(s.easeOutQuad(l,this._scrolling.position,r-t.innerHeight-this._scrolling.position,this._scrolling.speed));if(a<0)return void(this._scrolling.timer=null);r!==t.innerHeight+t.scrollY&&t.scrollTo(0,a),l<this._scrolling.speed?t.requestAnimationFrame((function(t){i._scroll(t)})):this._scrolling.timer=null}},{key:"_createTutorialSteps",value:function(t){var i=null;switch(t.highlight.charAt(0)){case".":i=e.getElementsByClassName(t.highlight.substr(1))[0];break;case"#":i=e.getElementById(t.highlight.substr(1));break;default:throw new Error("Unknown selector. Please only use id or class.")}if(!i)throw new Error("Selector "+t.highlight+" not found.");return new n(i,t.text,{title:t.title,callback:t.callback})}},{key:"_reset",value:function(){this.step=0,this.running=!1,this._transform={translateY:0,translateX:0}}},{key:"__load",value:function(){return function(){t.removeEventListener("load",this._eventHandler.load),this.start()}.bind(this)}},{key:"__resize",value:function(){return function(){this._highlightBox.classList.add("skip-animation"),this._highlightBox.style.left=this.elems[0].node.offsetLeft-this._padding.left,this._highlightBox.style.top=this.elems[0].node.offsetTop-this._padding.top,this._animateHighlightBox(),this._highlightBox.classList.remove("skip-animation")}.bind(this)}}]),l})();t.Tutorial||(t.Tutorial=l)})(window,document);