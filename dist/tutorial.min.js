"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=(function(){function t(t,e){var i=[],s=!0,n=!1,r=void 0;try{for(var o,l=t[Symbol.iterator]();!(s=(o=l.next()).done)&&(i.push(o.value),!e||i.length!==e);s=!0);}catch(t){n=!0,r=t}finally{try{!s&&l.return&&l.return()}finally{if(n)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),_createClass=(function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}})();!(function(t,e,i){var s=(function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mandatory",value:function(t){throw new Error(t+" is required.")}}]),t})(),n=(function(){function n(r){var o=this,l=r.selector,a=l===i?"tut-action":l,h=r.selectorList,u=h===i?[]:h,c=r.name,d=c===i?s.mandatory("Name"):c,g=r.persistent,p=g!==i&&g,m=r.buttons,f=m===i?{}:m,_=r.debug,v=_!==i&&_;if(_classCallCheck(this,n),u.length>0)this.elems=this._queryElementList(u);else{if(this.elems=Array.from(e.getElementsByClassName(a)),!this.elems.every((function(t){return t.getAttribute("t-step")})))throw new Error("Not all steps defined");this.elems.sort((function(t,e){return parseInt(t.getAttribute("t-step"))-parseInt(e.getAttribute("t-step"))}))}if(0===this.elems.length)throw new Error("No activities point defined");this._reset(),this._name=d,this._persistent=p,this._advancedStorage=this._checkStorageSupport(),this._step=parseInt(this._persistent?this._getCurrentPosition()||0:0),this.selector=a,this.buttons=f,this.animate=!0,this.animating=!1,this.buttons={close:f.close===i?"Close":f.close,previous:f.previous===i?"Back":f.close,next:f.next===i?"Next":f.close},this.debug=v,this._body=e.body,this._blurElement=this._createBlurElement();var y=this._createTutorialBox(),x=_slicedToArray(y,3);this._tutorialBox=x[0],this._tutorialText=x[1],this._tutorialPosition=x[2],this._highlightBox=this._createHighlightBox(this._tutorialBox),Object.defineProperty(this,"step",{get:function(){return o._step},set:function(t){o._step=t,o._persistent&&o._saveCurrentPosition()}}),t.addEventListener("resize",(function(){if(o.running){var t=o.elems[0].getBoundingClientRect();o._highlightBox.classList.add("skip-animation"),o._highlightBox.style.left=t.left-12,o._highlightBox.style.top=t.top-12,o._animateHighlightBox(),o._highlightBox.classList.remove("skip-animation")}}))}return _createClass(n,[{key:"start",value:function(){this.debug,this.running||(this.elems[this.step].classList.add("tutorial-highlight"),this._body.appendChild(this._blurElement),this._body.appendChild(this._highlightBox),this._moveHighlightBox(),this.running=!0)}},{key:"close",value:function(){this.running&&(this.elems[this.step].classList.remove("tutorial-highlight"),this._highlightBox.style.transform="",this._highlightBox.childNodes[0].style.transform="",this._body.removeChild(this._blurElement),this._body.removeChild(this._highlightBox),this._reset())}},{key:"prev",value:function(){this.running&&(this.animating||(this.debug,0===this.step?this.close():(this.elems[this.step].classList.remove("tutorial-highlight"),this.elems[--this.step].classList.add("tutorial-highlight"),this._moveHighlightBox()),this._saveCurrentPosition()))}},{key:"next",value:function(){this.running&&(this.animating||(this.debug,this.step===this.elems.length-1?this.close():(this.elems[this.step].classList.remove("tutorial-highlight"),this.elems[++this.step].classList.add("tutorial-highlight"),this._moveHighlightBox()),this._saveCurrentPosition()))}},{key:"goToStep",value:function(t){if(this.running){if(!this._stepInBounds(t))throw new Error("Step out of bounds.");t!==this.step&&(this.elems[this.step].classList.remove("tutorial-highlight"),this.step=t,this.elems[this.step].classList.add("tutorial-highlight"))}}},{key:"_stepInBounds",value:function(t){return t>=0&&t<this.elems.length}},{key:"_createBlurElement",value:function(){var t=this,i=e.createElement("div");return i.classList.add("tutorial-blur"),i.onclick=function(){t.close()},i}},{key:"_createHighlightBox",value:function(t){var i=e.createElement("div"),s=e.createElement("div"),n=e.createElement("i");return i.classList.add("tutorial-wrapper"),s.classList.add("tutorial-background"),n.classList.add("tutorial-index"),i.onlick=function(t){t.preventPropagation()},i.appendChild(s),i.appendChild(n),i.appendChild(t),i}},{key:"_createTutorialBox",value:function(){var t=this,i=e.createElement("div"),s=i.cloneNode(!1),n=i.cloneNode(!1),r=e.createElement("p"),o=r.cloneNode(),l=i.cloneNode(!1),a=e.createElement("div"),h=e.createElement("button"),u=e.createElement("a");u.href="#";var c=u.cloneNode(!1);return i.classList.add("tutorial-box"),s.classList.add("tutorial-box-edge"),n.classList.add("tutorial-box-wrapper"),r.classList.add("tutorial-description"),o.classList.add("tutorial-step-position"),l.classList.add("tutorial-buttons"),h.classList.add("tutorial-close"),h.textContent=this.buttons.close,u.textContent=this.buttons.previous,c.textContent=this.buttons.next,h.onclick=function(e){e.preventDefault(),t.close()},u.onclick=function(e){e.preventDefault(),t.prev()},c.onclick=function(e){e.preventDefault(),t.next()},l.appendChild(h),l.appendChild(a),a.appendChild(u),a.appendChild(c),n.appendChild(r),n.appendChild(o),n.appendChild(l),i.appendChild(s),i.appendChild(n),[i,r,o]}},{key:"_moveHighlightBox",value:function(){if(this.running&&this.animate)this.animating=!0,this._animateHighlightBox();else{var t=this.elems[this.step].getBoundingClientRect();this._highlightBox.style.top=t.top,this._highlightBox.style.left=t.left-12,this._highlightBox.childNodes[0].style.height=t.bottom-t.top+24,this._highlightBox.childNodes[0].style.width=t.width+24,this._tutorialBox.style.top=t.height+30+"px"}this._highlightBox.childNodes[1].innerText=this.step+1,this._tutorialPosition.textContent=this.step+1+"/"+this.elems.length}},{key:"_animateHighlightBox",value:function(){var t=this,e=this.elems[0].getBoundingClientRect(),i=this.elems[this.step].getBoundingClientRect();this._transform.translateY=i.top-e.top,this._transform.translateX=i.left-e.left,this._tutorialBox.style.top=i.height+30+"px",this._highlightBox.style.transform="translateX("+this._transform.translateX+"px) translateY("+this._transform.translateY+"px)",this._highlightBox.childNodes[0].style.width=i.width+24,this._highlightBox.childNodes[0].style.height=i.height+24,this._highlightBox.addEventListener("transitionend",(function(){t.animating=!1}))}},{key:"_queryElementList",value:function(t){var s=[],n=null,r=!0,o=!1,l=i;try{for(var a,h=t[Symbol.iterator]();!(r=(a=h.next()).done);r=!0){var u=a.value;switch(u.charAt(0)){case".":n=e.getElementsByClassName(u.substr(1,this.length))[0];break;case"#":n=e.getElementById(u.substr(1,this.length));break;default:throw new Error("Unknown selector. Please only use id or class.")}s.push(n)}}catch(t){o=!0,l=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw l}}return s}},{key:"_checkStorageSupport",value:function(){try{return localStorage.setItem("a",1),localStorage.removeItem("a"),!0}catch(t){return!1}}},{key:"_saveCurrentPosition",value:function(){this._advancedStorage?t.localStorage.setItem("tutorial-"+this._name,this.step):e.cookie+="tutorial-"+this._name+"="+this.step+";"}},{key:"_getCurrentPosition",value:function(){var i=this;return this._advancedStorage?t.localStorage.getItem("tutorial-"+this._name):e.cookie.split(",").filter((function(t){return t.includes("tutorial-"+i._name)})).map((function(t){return parseInt(t.replace("tutorial-"+i._name+"=",""))}))}},{key:"_reset",value:function(){this.step=0,this.running=!1,this._transform={translateY:0,translateX:0,scaleX:0,scaleY:0}}}]),n})();t.Tutorial||(t.Tutorial=n)})(window,document);